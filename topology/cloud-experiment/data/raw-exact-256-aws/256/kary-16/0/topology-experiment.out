MODULE STATS CONTENT
[1;39m{
  [0m[1;34m"count"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[1;34m"valid"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[1;34m"dirty"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[1;34m"size"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[1;34m"flush-batch-count"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[1;34m"mmap"[0m[1;39m: [0m[1;39m{
    [0m[1;34m"tags"[0m[1;39m: [0m[1;39m{}[0m[1;39m,
    [0m[1;34m"blobs"[0m[1;39m: [0m[0;39m0[0m[1;39m
  [1;39m}[0m[1;39m
[1;39m}[0m
NODES
256
TOPOLOGY diagram
0 flux-sample-0: full
â”œâ”€ 1 flux-sample-1: full
â”‚  â”œâ”€ 17 flux-sample-17: full
â”‚  â”œâ”€ 18 flux-sample-18: full
â”‚  â”œâ”€ 19 flux-sample-19: full
â”‚  â”œâ”€ 20 flux-sample-20: full
â”‚  â”œâ”€ 21 flux-sample-21: full
â”‚  â”œâ”€ 22 flux-sample-22: full
â”‚  â”œâ”€ 23 flux-sample-23: full
â”‚  â”œâ”€ 24 flux-sample-24: full
â”‚  â”œâ”€ 25 flux-sample-25: full
â”‚  â”œâ”€ 26 flux-sample-26: full
â”‚  â”œâ”€ 27 flux-sample-27: full
â”‚  â”œâ”€ 28 flux-sample-28: full
â”‚  â”œâ”€ 29 flux-sample-29: full
â”‚  â”œâ”€ 30 flux-sample-30: full
â”‚  â”œâ”€ 31 flux-sample-31: full
â”‚  â””â”€ 32 flux-sample-32: full
â”œâ”€ 2 flux-sample-2: full
â”‚  â”œâ”€ 33 flux-sample-33: full
â”‚  â”œâ”€ 34 flux-sample-34: full
â”‚  â”œâ”€ 35 flux-sample-35: full
â”‚  â”œâ”€ 36 flux-sample-36: full
â”‚  â”œâ”€ 37 flux-sample-37: full
â”‚  â”œâ”€ 38 flux-sample-38: full
â”‚  â”œâ”€ 39 flux-sample-39: full
â”‚  â”œâ”€ 40 flux-sample-40: full
â”‚  â”œâ”€ 41 flux-sample-41: full
â”‚  â”œâ”€ 42 flux-sample-42: full
â”‚  â”œâ”€ 43 flux-sample-43: full
â”‚  â”œâ”€ 44 flux-sample-44: full
â”‚  â”œâ”€ 45 flux-sample-45: full
â”‚  â”œâ”€ 46 flux-sample-46: full
â”‚  â”œâ”€ 47 flux-sample-47: full
â”‚  â””â”€ 48 flux-sample-48: full
â”œâ”€ 3 flux-sample-3: full
â”‚  â”œâ”€ 49 flux-sample-49: full
â”‚  â”œâ”€ 50 flux-sample-50: full
â”‚  â”œâ”€ 51 flux-sample-51: full
â”‚  â”œâ”€ 52 flux-sample-52: full
â”‚  â”œâ”€ 53 flux-sample-53: full
â”‚  â”œâ”€ 54 flux-sample-54: full
â”‚  â”œâ”€ 55 flux-sample-55: full
â”‚  â”œâ”€ 56 flux-sample-56: full
â”‚  â”œâ”€ 57 flux-sample-57: full
â”‚  â”œâ”€ 58 flux-sample-58: full
â”‚  â”œâ”€ 59 flux-sample-59: full
â”‚  â”œâ”€ 60 flux-sample-60: full
â”‚  â”œâ”€ 61 flux-sample-61: full
â”‚  â”œâ”€ 62 flux-sample-62: full
â”‚  â”œâ”€ 63 flux-sample-63: full
â”‚  â””â”€ 64 flux-sample-64: full
â”œâ”€ 4 flux-sample-4: full
â”‚  â”œâ”€ 65 flux-sample-65: full
â”‚  â”œâ”€ 66 flux-sample-66: full
â”‚  â”œâ”€ 67 flux-sample-67: full
â”‚  â”œâ”€ 68 flux-sample-68: full
â”‚  â”œâ”€ 69 flux-sample-69: full
â”‚  â”œâ”€ 70 flux-sample-70: full
â”‚  â”œâ”€ 71 flux-sample-71: full
â”‚  â”œâ”€ 72 flux-sample-72: full
â”‚  â”œâ”€ 73 flux-sample-73: full
â”‚  â”œâ”€ 74 flux-sample-74: full
â”‚  â”œâ”€ 75 flux-sample-75: full
â”‚  â”œâ”€ 76 flux-sample-76: full
â”‚  â”œâ”€ 77 flux-sample-77: full
â”‚  â”œâ”€ 78 flux-sample-78: full
â”‚  â”œâ”€ 79 flux-sample-79: full
â”‚  â””â”€ 80 flux-sample-80: full
â”œâ”€ 5 flux-sample-5: full
â”‚  â”œâ”€ 81 flux-sample-81: full
â”‚  â”œâ”€ 82 flux-sample-82: full
â”‚  â”œâ”€ 83 flux-sample-83: full
â”‚  â”œâ”€ 84 flux-sample-84: full
â”‚  â”œâ”€ 85 flux-sample-85: full
â”‚  â”œâ”€ 86 flux-sample-86: full
â”‚  â”œâ”€ 87 flux-sample-87: full
â”‚  â”œâ”€ 88 flux-sample-88: full
â”‚  â”œâ”€ 89 flux-sample-89: full
â”‚  â”œâ”€ 90 flux-sample-90: full
â”‚  â”œâ”€ 91 flux-sample-91: full
â”‚  â”œâ”€ 92 flux-sample-92: full
â”‚  â”œâ”€ 93 flux-sample-93: full
â”‚  â”œâ”€ 94 flux-sample-94: full
â”‚  â”œâ”€ 95 flux-sample-95: full
â”‚  â””â”€ 96 flux-sample-96: full
â”œâ”€ 6 flux-sample-6: full
â”‚  â”œâ”€ 97 flux-sample-97: full
â”‚  â”œâ”€ 98 flux-sample-98: full
â”‚  â”œâ”€ 99 flux-sample-99: full
â”‚  â”œâ”€ 100 flux-sample-100: full
â”‚  â”œâ”€ 101 flux-sample-101: full
â”‚  â”œâ”€ 102 flux-sample-102: full
â”‚  â”œâ”€ 103 flux-sample-103: full
â”‚  â”œâ”€ 104 flux-sample-104: full
â”‚  â”œâ”€ 105 flux-sample-105: full
â”‚  â”œâ”€ 106 flux-sample-106: full
â”‚  â”œâ”€ 107 flux-sample-107: full
â”‚  â”œâ”€ 108 flux-sample-108: full
â”‚  â”œâ”€ 109 flux-sample-109: full
â”‚  â”œâ”€ 110 flux-sample-110: full
â”‚  â”œâ”€ 111 flux-sample-111: full
â”‚  â””â”€ 112 flux-sample-112: full
â”œâ”€ 7 flux-sample-7: full
â”‚  â”œâ”€ 113 flux-sample-113: full
â”‚  â”œâ”€ 114 flux-sample-114: full
â”‚  â”œâ”€ 115 flux-sample-115: full
â”‚  â”œâ”€ 116 flux-sample-116: full
â”‚  â”œâ”€ 117 flux-sample-117: full
â”‚  â”œâ”€ 118 flux-sample-118: full
â”‚  â”œâ”€ 119 flux-sample-119: full
â”‚  â”œâ”€ 120 flux-sample-120: full
â”‚  â”œâ”€ 121 flux-sample-121: full
â”‚  â”œâ”€ 122 flux-sample-122: full
â”‚  â”œâ”€ 123 flux-sample-123: full
â”‚  â”œâ”€ 124 flux-sample-124: full
â”‚  â”œâ”€ 125 flux-sample-125: full
â”‚  â”œâ”€ 126 flux-sample-126: full
â”‚  â”œâ”€ 127 flux-sample-127: full
â”‚  â””â”€ 128 flux-sample-128: full
â”œâ”€ 8 flux-sample-8: full
â”‚  â”œâ”€ 129 flux-sample-129: full
â”‚  â”œâ”€ 130 flux-sample-130: full
â”‚  â”œâ”€ 131 flux-sample-131: full
â”‚  â”œâ”€ 132 flux-sample-132: full
â”‚  â”œâ”€ 133 flux-sample-133: full
â”‚  â”œâ”€ 134 flux-sample-134: full
â”‚  â”œâ”€ 135 flux-sample-135: full
â”‚  â”œâ”€ 136 flux-sample-136: full
â”‚  â”œâ”€ 137 flux-sample-137: full
â”‚  â”œâ”€ 138 flux-sample-138: full
â”‚  â”œâ”€ 139 flux-sample-139: full
â”‚  â”œâ”€ 140 flux-sample-140: full
â”‚  â”œâ”€ 141 flux-sample-141: full
â”‚  â”œâ”€ 142 flux-sample-142: full
â”‚  â”œâ”€ 143 flux-sample-143: full
â”‚  â””â”€ 144 flux-sample-144: full
â”œâ”€ 9 flux-sample-9: full
â”‚  â”œâ”€ 145 flux-sample-145: full
â”‚  â”œâ”€ 146 flux-sample-146: full
â”‚  â”œâ”€ 147 flux-sample-147: full
â”‚  â”œâ”€ 148 flux-sample-148: full
â”‚  â”œâ”€ 149 flux-sample-149: full
â”‚  â”œâ”€ 150 flux-sample-150: full
â”‚  â”œâ”€ 151 flux-sample-151: full
â”‚  â”œâ”€ 152 flux-sample-152: full
â”‚  â”œâ”€ 153 flux-sample-153: full
â”‚  â”œâ”€ 154 flux-sample-154: full
â”‚  â”œâ”€ 155 flux-sample-155: full
â”‚  â”œâ”€ 156 flux-sample-156: full
â”‚  â”œâ”€ 157 flux-sample-157: full
â”‚  â”œâ”€ 158 flux-sample-158: full
â”‚  â”œâ”€ 159 flux-sample-159: full
â”‚  â””â”€ 160 flux-sample-160: full
â”œâ”€ 10 flux-sample-10: full
â”‚  â”œâ”€ 161 flux-sample-161: full
â”‚  â”œâ”€ 162 flux-sample-162: full
â”‚  â”œâ”€ 163 flux-sample-163: full
â”‚  â”œâ”€ 164 flux-sample-164: full
â”‚  â”œâ”€ 165 flux-sample-165: full
â”‚  â”œâ”€ 166 flux-sample-166: full
â”‚  â”œâ”€ 167 flux-sample-167: full
â”‚  â”œâ”€ 168 flux-sample-168: full
â”‚  â”œâ”€ 169 flux-sample-169: full
â”‚  â”œâ”€ 170 flux-sample-170: full
â”‚  â”œâ”€ 171 flux-sample-171: full
â”‚  â”œâ”€ 172 flux-sample-172: full
â”‚  â”œâ”€ 173 flux-sample-173: full
â”‚  â”œâ”€ 174 flux-sample-174: full
â”‚  â”œâ”€ 175 flux-sample-175: full
â”‚  â””â”€ 176 flux-sample-176: full
â”œâ”€ 11 flux-sample-11: full
â”‚  â”œâ”€ 177 flux-sample-177: full
â”‚  â”œâ”€ 178 flux-sample-178: full
â”‚  â”œâ”€ 179 flux-sample-179: full
â”‚  â”œâ”€ 180 flux-sample-180: full
â”‚  â”œâ”€ 181 flux-sample-181: full
â”‚  â”œâ”€ 182 flux-sample-182: full
â”‚  â”œâ”€ 183 flux-sample-183: full
â”‚  â”œâ”€ 184 flux-sample-184: full
â”‚  â”œâ”€ 185 flux-sample-185: full
â”‚  â”œâ”€ 186 flux-sample-186: full
â”‚  â”œâ”€ 187 flux-sample-187: full
â”‚  â”œâ”€ 188 flux-sample-188: full
â”‚  â”œâ”€ 189 flux-sample-189: full
â”‚  â”œâ”€ 190 flux-sample-190: full
â”‚  â”œâ”€ 191 flux-sample-191: full
â”‚  â””â”€ 192 flux-sample-192: full
â”œâ”€ 12 flux-sample-12: full
â”‚  â”œâ”€ 193 flux-sample-193: full
â”‚  â”œâ”€ 194 flux-sample-194: full
â”‚  â”œâ”€ 195 flux-sample-195: full
â”‚  â”œâ”€ 196 flux-sample-196: full
â”‚  â”œâ”€ 197 flux-sample-197: full
â”‚  â”œâ”€ 198 flux-sample-198: full
â”‚  â”œâ”€ 199 flux-sample-199: full
â”‚  â”œâ”€ 200 flux-sample-200: full
â”‚  â”œâ”€ 201 flux-sample-201: full
â”‚  â”œâ”€ 202 flux-sample-202: full
â”‚  â”œâ”€ 203 flux-sample-203: full
â”‚  â”œâ”€ 204 flux-sample-204: full
â”‚  â”œâ”€ 205 flux-sample-205: full
â”‚  â”œâ”€ 206 flux-sample-206: full
â”‚  â”œâ”€ 207 flux-sample-207: full
â”‚  â””â”€ 208 flux-sample-208: full
â”œâ”€ 13 flux-sample-13: full
â”‚  â”œâ”€ 209 flux-sample-209: full
â”‚  â”œâ”€ 210 flux-sample-210: full
â”‚  â”œâ”€ 211 flux-sample-211: full
â”‚  â”œâ”€ 212 flux-sample-212: full
â”‚  â”œâ”€ 213 flux-sample-213: full
â”‚  â”œâ”€ 214 flux-sample-214: full
â”‚  â”œâ”€ 215 flux-sample-215: full
â”‚  â”œâ”€ 216 flux-sample-216: full
â”‚  â”œâ”€ 217 flux-sample-217: full
â”‚  â”œâ”€ 218 flux-sample-218: full
â”‚  â”œâ”€ 219 flux-sample-219: full
â”‚  â”œâ”€ 220 flux-sample-220: full
â”‚  â”œâ”€ 221 flux-sample-221: full
â”‚  â”œâ”€ 222 flux-sample-222: full
â”‚  â”œâ”€ 223 flux-sample-223: full
â”‚  â””â”€ 224 flux-sample-224: full
â”œâ”€ 14 flux-sample-14: full
â”‚  â”œâ”€ 225 flux-sample-225: full
â”‚  â”œâ”€ 226 flux-sample-226: full
â”‚  â”œâ”€ 227 flux-sample-227: full
â”‚  â”œâ”€ 228 flux-sample-228: full
â”‚  â”œâ”€ 229 flux-sample-229: full
â”‚  â”œâ”€ 230 flux-sample-230: full
â”‚  â”œâ”€ 231 flux-sample-231: full
â”‚  â”œâ”€ 232 flux-sample-232: full
â”‚  â”œâ”€ 233 flux-sample-233: full
â”‚  â”œâ”€ 234 flux-sample-234: full
â”‚  â”œâ”€ 235 flux-sample-235: full
â”‚  â”œâ”€ 236 flux-sample-236: full
â”‚  â”œâ”€ 237 flux-sample-237: full
â”‚  â”œâ”€ 238 flux-sample-238: full
â”‚  â”œâ”€ 239 flux-sample-239: full
â”‚  â””â”€ 240 flux-sample-240: full
â”œâ”€ 15 flux-sample-15: full
â”‚  â”œâ”€ 241 flux-sample-241: full
â”‚  â”œâ”€ 242 flux-sample-242: full
â”‚  â”œâ”€ 243 flux-sample-243: full
â”‚  â”œâ”€ 244 flux-sample-244: full
â”‚  â”œâ”€ 245 flux-sample-245: full
â”‚  â”œâ”€ 246 flux-sample-246: full
â”‚  â”œâ”€ 247 flux-sample-247: full
â”‚  â”œâ”€ 248 flux-sample-248: full
â”‚  â”œâ”€ 249 flux-sample-249: full
â”‚  â”œâ”€ 250 flux-sample-250: full
â”‚  â”œâ”€ 251 flux-sample-251: full
â”‚  â”œâ”€ 252 flux-sample-252: full
â”‚  â”œâ”€ 253 flux-sample-253: full
â”‚  â”œâ”€ 254 flux-sample-254: full
â”‚  â””â”€ 255 flux-sample-255: full
â””â”€ 16 flux-sample-16: full
TOPOLOGY description
kary:16
EVENT create-archive-1

real	0m9.071s
user	0m1.812s
sys	0m1.287s
EVENT distribute-all-nodes-1

real	0m2.527s
user	0m0.015s
sys	0m0.039s
EVENT delete-archive-all-nodes-1

real	0m0.046s
user	0m0.019s
sys	0m0.025s
EVENT clean-all-nodes-1

real	0m0.563s
user	0m0.021s
sys	0m0.017s
EVENT create-archive-2

real	0m19.383s
user	0m3.420s
sys	0m2.820s
EVENT distribute-all-nodes-2

real	0m18.307s
user	0m0.032s
sys	0m0.017s
EVENT delete-archive-all-nodes-2

real	0m0.049s
user	0m0.026s
sys	0m0.018s
EVENT clean-all-nodes-2

real	0m0.892s
user	0m0.019s
sys	0m0.024s
EVENT create-archive-3

real	0m29.352s
user	0m5.143s
sys	0m4.225s
EVENT distribute-all-nodes-3

real	0m48.867s
user	0m0.017s
sys	0m0.033s
EVENT delete-archive-all-nodes-3

real	0m0.068s
user	0m0.005s
sys	0m0.037s
EVENT clean-all-nodes-3

real	0m1.037s
user	0m0.023s
sys	0m0.023s
EVENT create-archive-4

real	0m39.683s
user	0m7.021s
sys	0m5.634s
EVENT distribute-all-nodes-4

real	1m19.371s
user	0m0.023s
sys	0m0.028s
EVENT delete-archive-all-nodes-4

real	0m0.071s
user	0m0.018s
sys	0m0.022s
EVENT clean-all-nodes-4

real	0m1.095s
user	0m0.014s
sys	0m0.029s
EVENT create-archive-5

real	0m49.986s
user	0m8.907s
sys	0m7.071s
EVENT distribute-all-nodes-5

real	1m48.630s
user	0m0.029s
sys	0m0.023s
EVENT delete-archive-all-nodes-5

real	0m0.241s
user	0m0.021s
sys	0m0.021s
EVENT clean-all-nodes-5

real	0m1.305s
user	0m0.034s
sys	0m0.011s
EVENT create-archive-6

real	0m59.924s
user	0m10.650s
sys	0m8.220s
EVENT distribute-all-nodes-6

real	2m19.188s
user	0m0.029s
sys	0m0.023s
EVENT delete-archive-all-nodes-6

real	0m0.071s
user	0m0.009s
sys	0m0.032s
EVENT clean-all-nodes-6

real	0m1.433s
user	0m0.036s
sys	0m0.007s
EVENT create-archive-7

real	1m10.090s
user	0m12.164s
sys	0m9.902s
EVENT distribute-all-nodes-7

real	2m48.896s
user	0m0.034s
sys	0m0.027s
EVENT delete-archive-all-nodes-7

real	0m0.192s
user	0m0.015s
sys	0m0.029s
EVENT clean-all-nodes-7

real	0m1.478s
user	0m0.018s
sys	0m0.027s
EVENT create-archive-8

real	1m20.389s
user	0m14.124s
sys	0m11.145s
EVENT distribute-all-nodes-8

real	3m18.864s
user	0m0.023s
sys	0m0.032s
EVENT delete-archive-all-nodes-8

real	0m0.272s
user	0m0.005s
sys	0m0.037s
EVENT clean-all-nodes-8

real	0m1.680s
user	0m0.029s
sys	0m0.013s
EVENT create-archive-9

real	1m30.230s
user	0m15.730s
sys	0m12.338s
EVENT distribute-all-nodes-9

real	3m47.779s
user	0m0.018s
sys	0m0.041s
EVENT delete-archive-all-nodes-9

real	0m0.251s
user	0m0.037s
sys	0m0.014s
EVENT clean-all-nodes-9

real	0m1.801s
user	0m0.017s
sys	0m0.029s
EVENT create-archive-10

real	1m30.913s
user	0m17.288s
sys	0m13.330s
EVENT distribute-all-nodes-10

real	4m18.081s
user	0m0.035s
sys	0m0.018s
EVENT delete-archive-all-nodes-10

real	0m0.281s
user	0m0.010s
sys	0m0.039s
EVENT clean-all-nodes-10

real	0m1.902s
user	0m0.029s
sys	0m0.017s
SCRIPT entrypoint

#!/bin/bash
# flux-topology.sh

flux exec -r all flux module reload content purge-target-size=104857600 # 100mb
echo "MODULE STATS CONTENT"
flux module stats content | jq

# Print the overlay to show the topology
echo "NODES"
echo "256"
echo "TOPOLOGY diagram"
flux overlay status
echo "TOPOLOGY description"
echo "kary:16"

# Go up to 10 sizes for now (matches container size)
for size in $(seq 1 10)
  do
    # Create the archive and time it
    echo "EVENT create-archive-${size}"
    time  flux archive create --name create-archive-${size} --dir /chonks ${size}gb.txt

    # Distribute to all nodes, but to /tmp because file exists in /chonks
    echo "EVENT distribute-all-nodes-${size}"
    time flux exec -r all -x 0  flux archive extract --name create-archive-${size} -C /tmp
    sleep 2

    echo "EVENT delete-archive-all-nodes-${size}"
    time flux exec -r all  flux archive remove --name create-archive-${size} 2>/dev/null
    sleep 2

    # Cleanup all archive on all nodes
    echo "EVENT clean-all-nodes-${size}"
    time flux exec -r all rm -rf /tmp/${size}gb.txt
    sleep 2
done

# Show self!
echo "SCRIPT entrypoint"
cat $0
