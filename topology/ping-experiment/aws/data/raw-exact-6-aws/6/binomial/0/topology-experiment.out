ðŸŸ§ï¸  wait-fs: 2024/12/29 06:13:24 wait-fs.go:40: /mnt/flux/flux-operator-done.txt
ðŸŸ§ï¸  wait-fs: 2024/12/29 06:13:24 wait-fs.go:49: Found existing path /mnt/flux/flux-operator-done.txt

Hello user root

ðŸŒŸï¸ Curve Certificate
curve.cert
#   ****  Generated on 2023-04-26 22:54:42 by CZMQ  ****
#   ZeroMQ CURVE **Secret** Certificate
#   DO NOT PROVIDE THIS FILE TO OTHER USERS nor change its permissions.
    
metadata
    name = "flux-cert-generator"
    keygen.hostname = "flux-sample-0"
curve
    public-key = ".kYB%CZgG[YdGY3D=S*^K^?{sea4.OeQ+RGG*md2"
    secret-key = "zf-}-y/BYslSnW{c[70&H{PQaayz08^w%RrN+nHs"

ðŸ“¦ Resources
flux R encode --hosts=flux-sample-[0-5] --local
{"version": 1, "execution": {"R_lite": [{"rank": "0-5", "children": {"core": "0-7"}}], "starttime": 0.0, "expiration": 0.0, "nodelist": ["flux-sample-[0-5]"]}}
ðŸ‘‹ Hello, I'm flux-sample-0
The main host is flux-sample-0
The working directory is /home/fluxuser, contents include:
ðŸš©ï¸ Flux Option Flags defined
Command provided is: /bin/bash /entrypoint.sh

ðŸŒ€ Launcher Mode: flux start -o --config /mnt/flux/view/etc/flux/config -Scron.directory=/etc/flux/system/cron.d   -Stbon.fanout=256   -Srundir=/mnt/flux/view/run/flux    -Sstatedir=/mnt/flux/view/var/lib/flux -Slocal-uri=local:///mnt/flux/view/run/flux/local -Stbon.connect_timeout=5s -Stbon.topo=binomial    -Slog-stderr-level=6    -Slog-stderr-mode=local  
broker.info[0]: start: none->join 0.368968ms
broker.info[0]: parent-none: join->init 0.017831ms
cron.info[0]: synchronizing cron tasks to event heartbeat.pulse
job-manager.info[0]: restart: 0 jobs
job-manager.info[0]: restart: 0 running jobs
job-manager.info[0]: restart: checkpoint.job-manager not found
broker.info[0]: rc1.0: running /etc/flux/rc1.d/01-sched-fluxion
sched-fluxion-resource.info[0]: version 0.40.0-4-g3fb0b4e7
sched-fluxion-resource.warning[0]: create_reader: allowlist unsupported
sched-fluxion-resource.info[0]: populate_resource_db: loaded resources from core's resource.acquire
sched-fluxion-qmanager.info[0]: version 0.40.0-4-g3fb0b4e7
broker.info[0]: rc1.0: running /etc/flux/rc1.d/02-cron
broker.info[0]: rc1.0: /etc/flux/rc1 Exited (rc=0) 0.2s
broker.info[0]: rc1-success: init->quorum 0.225297s
broker.info[0]: online: flux-sample-0 (ranks 0)
broker.info[0]: online: flux-sample-[0-5] (ranks 0-5)
broker.info[0]: quorum-full: quorum->run 5.48683s
MODULE STATS CONTENT
[1;39m{
  [0m[34;1m"count"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[34;1m"valid"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[34;1m"dirty"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[34;1m"size"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[34;1m"flush-batch-count"[0m[1;39m: [0m[0;39m0[0m[1;39m,
  [0m[34;1m"mmap"[0m[1;39m: [0m[1;39m{
    [0m[34;1m"tags"[0m[1;39m: [0m[1;39m{}[0m[1;39m,
    [0m[34;1m"blobs"[0m[1;39m: [0m[0;39m0[0m[1;39m
  [1;39m}[0m[1;39m
[1;39m}[0m
NODES
6
TOPOLOGY diagram
0 flux-sample-0: full
â”œâ”€ 1 flux-sample-1: full
â”œâ”€ 2 flux-sample-2: full
â”‚  â””â”€ 3 flux-sample-3: full
â””â”€ 4 flux-sample-4: full
   â””â”€ 5 flux-sample-5: full
TOPOLOGY description
binomial
RANKS 6
EVENT flux-ping-broker-size-0-rank-0
flux-ping 0!broker
0!broker.ping pad=0 seq=0 time=0.134 ms (cffe85fe!d67f3e03!98353e02)
EVENT flux-ping-kvs-size-0-rank-0
flux-ping 0!kvs
0!kvs.ping pad=0 seq=0 time=0.197 ms (9b192c23!d67f3e03!98353e02!98353e02)
EVENT flux-ping-broker-size-0-rank-1
flux-ping 1!broker
1!broker.ping pad=0 seq=0 time=0.493 ms (1bc7339f!d67f3e03!98353e02!8a50cacb)
EVENT flux-ping-kvs-size-0-rank-1
flux-ping 1!kvs
1!kvs.ping pad=0 seq=0 time=0.514 ms (8d58159e!d67f3e03!98353e02!8a50cacb!8a50cacb)
EVENT flux-ping-broker-size-0-rank-2
flux-ping 2!broker
2!broker.ping pad=0 seq=0 time=0.438 ms (a1a3f651!d67f3e03!98353e02!0ef72d33)
EVENT flux-ping-kvs-size-0-rank-2
flux-ping 2!kvs
2!kvs.ping pad=0 seq=0 time=0.581 ms (22ae1a9a!d67f3e03!98353e02!0ef72d33!0ef72d33)
EVENT flux-ping-broker-size-0-rank-3
flux-ping 3!broker
3!broker.ping pad=0 seq=0 time=0.751 ms (6434e472!d67f3e03!98353e02!0ef72d33!457f185d)
EVENT flux-ping-kvs-size-0-rank-3
flux-ping 3!kvs
3!kvs.ping pad=0 seq=0 time=0.795 ms (d7c8588d!d67f3e03!98353e02!0ef72d33!457f185d!457f185d)
EVENT flux-ping-broker-size-0-rank-4
flux-ping 4!broker
4!broker.ping pad=0 seq=0 time=0.461 ms (88aaeaad!d67f3e03!98353e02!5c2eb018)
EVENT flux-ping-kvs-size-0-rank-4
flux-ping 4!kvs
4!kvs.ping pad=0 seq=0 time=0.503 ms (379e20a9!d67f3e03!98353e02!5c2eb018!5c2eb018)
EVENT flux-ping-broker-size-0-rank-5
flux-ping 5!broker
5!broker.ping pad=0 seq=0 time=0.899 ms (ad50577e!d67f3e03!98353e02!5c2eb018!74d1e40b)
EVENT flux-ping-kvs-size-0-rank-5
flux-ping 5!kvs
5!kvs.ping pad=0 seq=0 time=0.867 ms (304e8f99!d67f3e03!98353e02!5c2eb018!74d1e40b!74d1e40b)
EVENT flux-ping-broker-size-200-rank-0
flux-ping 0!broker
0!broker.ping pad=209715200 seq=0 time=8661.646 ms (808afe9e!d67f3e03!98353e02)
EVENT flux-ping-kvs-size-200-rank-0
flux-ping 0!kvs
0!kvs.ping pad=209715200 seq=0 time=8685.296 ms (bd3ac577!d67f3e03!98353e02!98353e02)
EVENT flux-ping-broker-size-200-rank-1
flux-ping 1!broker
1!broker.ping pad=209715200 seq=0 time=10716.776 ms (af3fc24d!d67f3e03!98353e02!8a50cacb)
EVENT flux-ping-kvs-size-200-rank-1
flux-ping 1!kvs
1!kvs.ping pad=209715200 seq=0 time=10656.036 ms (7d88abb9!d67f3e03!98353e02!8a50cacb!8a50cacb)
EVENT flux-ping-broker-size-200-rank-2
flux-ping 2!broker
2!broker.ping pad=209715200 seq=0 time=10642.721 ms (d0e5a44d!d67f3e03!98353e02!0ef72d33)
EVENT flux-ping-kvs-size-200-rank-2
flux-ping 2!kvs
2!kvs.ping pad=209715200 seq=0 time=10623.447 ms (1939de07!d67f3e03!98353e02!0ef72d33!0ef72d33)
EVENT flux-ping-broker-size-200-rank-3
flux-ping 3!broker
3!broker.ping pad=209715200 seq=0 time=12672.636 ms (bc296f83!d67f3e03!98353e02!0ef72d33!457f185d)
EVENT flux-ping-kvs-size-200-rank-3
flux-ping 3!kvs
3!kvs.ping pad=209715200 seq=0 time=12642.916 ms (17f5f66f!d67f3e03!98353e02!0ef72d33!457f185d!457f185d)
EVENT flux-ping-broker-size-200-rank-4
flux-ping 4!broker
4!broker.ping pad=209715200 seq=0 time=10657.719 ms (02a74e1f!d67f3e03!98353e02!5c2eb018)
EVENT flux-ping-kvs-size-200-rank-4
flux-ping 4!kvs
4!kvs.ping pad=209715200 seq=0 time=10636.759 ms (ba861fc3!d67f3e03!98353e02!5c2eb018!5c2eb018)
EVENT flux-ping-broker-size-200-rank-5
flux-ping 5!broker
5!broker.ping pad=209715200 seq=0 time=12676.317 ms (141bd9e5!d67f3e03!98353e02!5c2eb018!74d1e40b)
EVENT flux-ping-kvs-size-200-rank-5
flux-ping 5!kvs
5!kvs.ping pad=209715200 seq=0 time=12637.727 ms (5e887ff1!d67f3e03!98353e02!5c2eb018!74d1e40b!74d1e40b)
EVENT flux-ping-broker-size-400-rank-0
flux-ping 0!broker
0!broker.ping pad=419430400 seq=0 time=17327.510 ms (c8e8d36a!d67f3e03!98353e02)
EVENT flux-ping-kvs-size-400-rank-0
flux-ping 0!kvs
0!kvs.ping pad=419430400 seq=0 time=17216.269 ms (d2d7f43a!d67f3e03!98353e02!98353e02)
EVENT flux-ping-broker-size-400-rank-1
flux-ping 1!broker
1!broker.ping pad=419430400 seq=0 time=21309.944 ms (44bd5a52!d67f3e03!98353e02!8a50cacb)
EVENT flux-ping-kvs-size-400-rank-1
flux-ping 1!kvs
1!kvs.ping pad=419430400 seq=0 time=21272.230 ms (9172af21!d67f3e03!98353e02!8a50cacb!8a50cacb)
EVENT flux-ping-broker-size-400-rank-2
flux-ping 2!broker
2!broker.ping pad=419430400 seq=0 time=21297.326 ms (6373e012!d67f3e03!98353e02!0ef72d33)
EVENT flux-ping-kvs-size-400-rank-2
flux-ping 2!kvs
2!kvs.ping pad=419430400 seq=0 time=21258.546 ms (b5a89df9!d67f3e03!98353e02!0ef72d33!0ef72d33)
EVENT flux-ping-broker-size-400-rank-3
flux-ping 3!broker
3!broker.ping pad=419430400 seq=0 time=25237.159 ms (74c6596d!d67f3e03!98353e02!0ef72d33!457f185d)
EVENT flux-ping-kvs-size-400-rank-3
flux-ping 3!kvs
3!kvs.ping pad=419430400 seq=0 time=25224.544 ms (5103d5f8!d67f3e03!98353e02!0ef72d33!457f185d!457f185d)
EVENT flux-ping-broker-size-400-rank-4
flux-ping 4!broker
4!broker.ping pad=419430400 seq=0 time=21281.439 ms (86821ff9!d67f3e03!98353e02!5c2eb018)
EVENT flux-ping-kvs-size-400-rank-4
flux-ping 4!kvs
4!kvs.ping pad=419430400 seq=0 time=21255.660 ms (f880aac9!d67f3e03!98353e02!5c2eb018!5c2eb018)
EVENT flux-ping-broker-size-400-rank-5
flux-ping 5!broker
5!broker.ping pad=419430400 seq=0 time=25292.180 ms (48516e16!d67f3e03!98353e02!5c2eb018!74d1e40b)
EVENT flux-ping-kvs-size-400-rank-5
flux-ping 5!kvs
5!kvs.ping pad=419430400 seq=0 time=25276.267 ms (aa5937bb!d67f3e03!98353e02!5c2eb018!74d1e40b!74d1e40b)
EVENT flux-ping-broker-size-600-rank-0
flux-ping 0!broker
0!broker.ping pad=629145600 seq=0 time=26247.224 ms (583e5fdc!d67f3e03!98353e02)
EVENT flux-ping-kvs-size-600-rank-0
flux-ping 0!kvs
0!kvs.ping pad=629145600 seq=0 time=26242.794 ms (7df4cc89!d67f3e03!98353e02!98353e02)
EVENT flux-ping-broker-size-600-rank-1
flux-ping 1!broker
1!broker.ping pad=629145600 seq=0 time=32287.956 ms (427c96e7!d67f3e03!98353e02!8a50cacb)
EVENT flux-ping-kvs-size-600-rank-1
flux-ping 1!kvs
1!kvs.ping pad=629145600 seq=0 time=32256.057 ms (bfb236ff!d67f3e03!98353e02!8a50cacb!8a50cacb)
EVENT flux-ping-broker-size-600-rank-2
flux-ping 2!broker
2!broker.ping pad=629145600 seq=0 time=32289.300 ms (9e3e022c!d67f3e03!98353e02!0ef72d33)
EVENT flux-ping-kvs-size-600-rank-2
flux-ping 2!kvs
2!kvs.ping pad=629145600 seq=0 time=32222.792 ms (cf475d36!d67f3e03!98353e02!0ef72d33!0ef72d33)
EVENT flux-ping-broker-size-600-rank-3
flux-ping 3!broker
3!broker.ping pad=629145600 seq=0 time=38390.336 ms (24f995b1!d67f3e03!98353e02!0ef72d33!457f185d)
EVENT flux-ping-kvs-size-600-rank-3
flux-ping 3!kvs
3!kvs.ping pad=629145600 seq=0 time=38289.345 ms (ef71a8e3!d67f3e03!98353e02!0ef72d33!457f185d!457f185d)
EVENT flux-ping-broker-size-600-rank-4
flux-ping 4!broker
4!broker.ping pad=629145600 seq=0 time=32270.337 ms (ea423cdf!d67f3e03!98353e02!5c2eb018)
EVENT flux-ping-kvs-size-600-rank-4
flux-ping 4!kvs
4!kvs.ping pad=629145600 seq=0 time=32264.385 ms (b57519bf!d67f3e03!98353e02!5c2eb018!5c2eb018)
EVENT flux-ping-broker-size-600-rank-5
flux-ping 5!broker
5!broker.ping pad=629145600 seq=0 time=38249.429 ms (6c364a4b!d67f3e03!98353e02!5c2eb018!74d1e40b)
EVENT flux-ping-kvs-size-600-rank-5
flux-ping 5!kvs
5!kvs.ping pad=629145600 seq=0 time=38169.204 ms (175e2c3e!d67f3e03!98353e02!5c2eb018!74d1e40b!74d1e40b)
EVENT flux-ping-broker-size-800-rank-0
flux-ping 0!broker
0!broker.ping pad=838860800 seq=0 time=34583.053 ms (50f01019!d67f3e03!98353e02)
EVENT flux-ping-kvs-size-800-rank-0
flux-ping 0!kvs
0!kvs.ping pad=838860800 seq=0 time=34534.098 ms (8552e3a8!d67f3e03!98353e02!98353e02)
EVENT flux-ping-broker-size-800-rank-1
flux-ping 1!broker
1!broker.ping pad=838860800 seq=0 time=42984.794 ms (5ed065d0!d67f3e03!98353e02!8a50cacb)
EVENT flux-ping-kvs-size-800-rank-1
flux-ping 1!kvs
1!kvs.ping pad=838860800 seq=0 time=43007.265 ms (a1b7bed7!d67f3e03!98353e02!8a50cacb!8a50cacb)
EVENT flux-ping-broker-size-800-rank-2
flux-ping 2!broker
2!broker.ping pad=838860800 seq=0 time=42565.844 ms (231080aa!d67f3e03!98353e02!0ef72d33)
EVENT flux-ping-kvs-size-800-rank-2
flux-ping 2!kvs
2!kvs.ping pad=838860800 seq=0 time=42605.352 ms (b7f69781!d67f3e03!98353e02!0ef72d33!0ef72d33)
EVENT flux-ping-broker-size-800-rank-3
flux-ping 3!broker
3!broker.ping pad=838860800 seq=0 time=50557.994 ms (8b6b9a4c!d67f3e03!98353e02!0ef72d33!457f185d)
EVENT flux-ping-kvs-size-800-rank-3
flux-ping 3!kvs
3!kvs.ping pad=838860800 seq=0 time=50594.124 ms (34a9ddb0!d67f3e03!98353e02!0ef72d33!457f185d!457f185d)
EVENT flux-ping-broker-size-800-rank-4
flux-ping 4!broker
4!broker.ping pad=838860800 seq=0 time=42642.377 ms (e394f49f!d67f3e03!98353e02!5c2eb018)
EVENT flux-ping-kvs-size-800-rank-4
flux-ping 4!kvs
4!kvs.ping pad=838860800 seq=0 time=42653.521 ms (80575cc0!d67f3e03!98353e02!5c2eb018!5c2eb018)
EVENT flux-ping-broker-size-800-rank-5
flux-ping 5!broker
5!broker.ping pad=838860800 seq=0 time=50588.104 ms (ca69a7dd!d67f3e03!98353e02!5c2eb018!74d1e40b)
EVENT flux-ping-kvs-size-800-rank-5
flux-ping 5!kvs
5!kvs.ping pad=838860800 seq=0 time=50753.052 ms (94177544!d67f3e03!98353e02!5c2eb018!74d1e40b!74d1e40b)
EVENT flux-ping-broker-size-1000-rank-0
flux-ping 0!broker
0!broker.ping pad=1048576000 seq=0 time=43009.394 ms (3f23a01e!d67f3e03!98353e02)
EVENT flux-ping-kvs-size-1000-rank-0
flux-ping 0!kvs
0!kvs.ping pad=1048576000 seq=0 time=42937.604 ms (c18a9ca4!d67f3e03!98353e02!98353e02)
EVENT flux-ping-broker-size-1000-rank-1
flux-ping 1!broker
1!broker.ping pad=1048576000 seq=0 time=53707.772 ms (169c0e5d!d67f3e03!98353e02!8a50cacb)
EVENT flux-ping-kvs-size-1000-rank-1
flux-ping 1!kvs
1!kvs.ping pad=1048576000 seq=0 time=53559.295 ms (4d7846e6!d67f3e03!98353e02!8a50cacb!8a50cacb)
EVENT flux-ping-broker-size-1000-rank-2
flux-ping 2!broker
broker.err[0]: broker on flux-sample-2 (rank 2) has been unresponsive for 31.9994s
broker.err[0]: broker on flux-sample-2 (rank 2) is responsive now
2!broker.ping pad=1048576000 seq=0 time=52848.755 ms (50e340d8!d67f3e03!98353e02!0ef72d33)
EVENT flux-ping-kvs-size-1000-rank-2
flux-ping 2!kvs
2!kvs.ping pad=1048576000 seq=0 time=53010.381 ms (fffccdf6!d67f3e03!98353e02!0ef72d33!0ef72d33)
EVENT flux-ping-broker-size-1000-rank-3
flux-ping 3!broker
3!broker.ping pad=1048576000 seq=0 time=63397.100 ms (a6e12e5a!d67f3e03!98353e02!0ef72d33!457f185d)
EVENT flux-ping-kvs-size-1000-rank-3
flux-ping 3!kvs
3!kvs.ping pad=1048576000 seq=0 time=63075.473 ms (1c4e2586!d67f3e03!98353e02!0ef72d33!457f185d!457f185d)
EVENT flux-ping-broker-size-1000-rank-4
flux-ping 4!broker
4!broker.ping pad=1048576000 seq=0 time=53320.608 ms (f74f48b1!d67f3e03!98353e02!5c2eb018)
EVENT flux-ping-kvs-size-1000-rank-4
flux-ping 4!kvs
4!kvs.ping pad=1048576000 seq=0 time=53239.820 ms (e9f15cdf!d67f3e03!98353e02!5c2eb018!5c2eb018)
EVENT flux-ping-broker-size-1000-rank-5
flux-ping 5!broker
5!broker.ping pad=1048576000 seq=0 time=63083.910 ms (e1271113!d67f3e03!98353e02!5c2eb018!74d1e40b)
EVENT flux-ping-kvs-size-1000-rank-5
flux-ping 5!kvs
5!kvs.ping pad=1048576000 seq=0 time=63067.358 ms (d9483c0c!d67f3e03!98353e02!5c2eb018!74d1e40b!74d1e40b)
SCRIPT entrypoint

#!/bin/bash
# flux-topology.sh

flux exec -r all flux module reload content purge-target-size=104857600 # 100mb
echo "MODULE STATS CONTENT"
flux module stats content | jq

# Print the overlay to show the topology
echo "NODES"
echo "6"
echo "TOPOLOGY diagram"
flux overlay status
echo "TOPOLOGY description"
echo "binomial"

# Get the total size (number of children)
ranks=$(flux getattr size)
echo "RANKS ${ranks}"

# But we are testing this many...
nodes=6

# We start counting at 0
max_rank="$((nodes-1))"

# --pad
# Include in the payload a string of length *N* bytes. *N* may be a floating point number with optional multiplicative suffix (K,M,G). The payload will be echoed back in the response. This option can be used to explore the effect of message size on latency. Default: no padding.

# Limit is 2G
# flux-ping: flux-ping: pad: value 8192M too large (must be < 2G)

# target may be the name of a Flux service, e.g. "kvs". :program:`flux ping` will send a request to "kvs.ping". As a shorthand, target can include a rank or host prefix delimited by an exclamation point. :program:`flux ping 4!kvs` is equivalent to :option:`flux ping --rank 4 kvs` (see :option:`--rank` option below). Don't forget to quote the exclamation point if it is interpreted by your shell.

# As a shorthand, target may also simply be a rank or host by itself indicating that the broker on that rank/host, rather than a Flux service, is to be pinged. :command:`flux ping 1` is equivalent to :option:`flux ping --rank 1 broker`.
# Sizes 0, 200, 400, 600, 800, 1000 M

# Run flux ping for each of the kvs and broker, across all ranks (testing the topology) and message sizes up to
# Go up to 1000MB (1GB) 
for size in $(echo 0 200 400 600 800 1000)
  do
  for rank in $(seq 0 ${max_rank})
    do
    echo "EVENT flux-ping-broker-size-${size}-rank-${rank}"
    flux ping -c1 --pad=${size}M --rank ${rank} broker
    echo "EVENT flux-ping-kvs-size-${size}-rank-${rank}"
    flux ping -c1 --pad=${size}M --rank ${rank} kvs
  done
done

# Show self!
echo "SCRIPT entrypoint"
cat $0broker.info[0]: rc2.0: /bin/bash /entrypoint.sh Exited (rc=0) 2006.2s
broker.info[0]: rc2-success: run->cleanup 33.4374m
broker.info[0]: cleanup.0: flux queue stop --quiet --all --nocheckpoint Exited (rc=0) 0.1s
broker.info[0]: cleanup.1: flux resource acquire-mute Exited (rc=0) 0.1s
broker.info[0]: cleanup.2: flux cancel --user=all --quiet --states RUN Exited (rc=0) 0.1s
broker.info[0]: cleanup.3: flux queue idle --quiet Exited (rc=0) 0.1s
broker.info[0]: cleanup-success: cleanup->shutdown 0.381623s
broker.info[0]: children-complete: shutdown->finalize 0.112354s
broker.info[0]: rc3.0: running /etc/flux/rc3.d/01-sched-fluxion
kvs.err[0]: content_load_completion: content_load_get: No such file or directory
broker.err[0]: rc3.0: flux: Error committing finish event: No such file or directory
broker.err[0]: rc3.0: flux-content: content.flush: Function not implemented
content-sqlite.err[0]: unregister-backing: content backing store is not active: Invalid argument
broker.err[0]: rc3.0: /etc/flux/rc3 Exited (rc=1) 0.1s
broker.info[0]: rc3-fail: finalize->goodbye 0.113559s
broker.info[0]: goodbye: goodbye->exit 0.045082ms
